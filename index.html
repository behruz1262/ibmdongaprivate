<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Information Management - Yuldoshev Behruz</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #000;
      color: #fff;
      margin: 0;
      padding: 0;
      line-height: 1.6;
    }
    header {
      background-color: #111;
      padding: 40px 20px;
      text-align: center;
      border-bottom: 2px solid #00ff00;
    }
    header h1 {
      margin: 0;
      font-size: 2.5em;
      color: #00ff00;
    }
    header p {
      margin: 10px 0 0;
      font-size: 1.2em;
      color: #ccc;
    }
    main {
      padding: 20px;
      max-width: 800px;
      margin: 0 auto;
    }
    section {
      margin-bottom: 40px;
      background-color: #1a1a1a;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    h2 {
      color: #00ff00;
      border-bottom: 2px solid #00ff00;
      padding-bottom: 10px;
      font-size: 1.8em;
      display: flex;
      align-items: center;
    }
    h2 i {
      margin-right: 10px;
    }
    ul {
      list-style-type: none;
      padding: 0;
    }
    ul li {
      margin: 15px 0;
      display: flex;
      flex-direction: column;
    }
    ul li a {
      color: #00ff00;
      text-decoration: none;
      font-size: 1.1em;
      transition: color 0.3s ease;
      word-break: break-word;
    }
    ul li a:hover {
      color: #00cc00;
      text-decoration: underline;
    }
    ul li button {
      align-self: flex-start;
      background-color: #ff4444;
      color: #fff;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 0.9em;
      border-radius: 5px;
      transition: background-color 0.3s ease;
      margin-top: 5px;
    }
    ul li button:hover {
      background-color: #cc0000;
    }
  </style>
</head>
<body>
  <header>
    <h1>Yuldoshev Behruz's Portfolio</h1>
    <p>Your current grade is: <span id="grade-value">Loading...</span></p>
  </header>
  <main>
    <section>
      <h2><i class="fas fa-folder"></i> Manage Folders</h2>
      <form id="folder-form">
        <input type="text" id="folder-name" placeholder="Enter folder name" required>
        <button type="submit">Create Folder</button>
      </form>
    </section>
    <section>
      <h2><i class="fas fa-file-upload"></i> Upload Assignment</h2>
      <form id="upload-form">
        <select id="folder-select">
          <option value="">-- Select Folder --</option>
        </select>
        <input type="file" id="file-input">
        <input type="url" id="link-input" placeholder="or paste a file/link URL">
        <button type="submit">Upload</button>
      </form>
    </section>
    <section>
      <h2><i class="fas fa-folder-open"></i> Uploaded Files</h2>
      <div id="folders-container"></div>
    </section>
  </main>
  <script>
    window.folders = window.folders || JSON.parse(localStorage.getItem('folders')) || {};
    function saveFolders() {
      localStorage.setItem('folders', JSON.stringify(window.folders));
    }
    function refreshFolderSelect() {
      const select = document.getElementById('folder-select');
      select.innerHTML = '<option value="">-- Select Folder --</option>';
      Object.keys(window.folders).forEach(folder => {
        const option = document.createElement('option');
        option.value = folder;
        option.textContent = folder;
        select.appendChild(option);
      });
    }
    function refreshFoldersDisplay() {
      const container = document.getElementById('folders-container');
      container.innerHTML = '';
      Object.entries(window.folders).forEach(([folderName, files]) => {
        const section = document.createElement('section');
        section.innerHTML = `<h3>${folderName}</h3>`;
        const ul = document.createElement('ul');
        files.forEach((file, index) => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          if (file.url.endsWith('.doc') || file.url.endsWith('.docx')) {
            a.href = `https://view.officeapps.live.com/op/view.aspx?src=${encodeURIComponent(file.url)}`;
          } else {
            a.href = file.url;
          }
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          a.textContent = file.name;
          const del = document.createElement('button');
          del.textContent = 'Delete';
          del.onclick = () => {
            window.folders[folderName].splice(index, 1);
            if (window.folders[folderName].length === 0) delete window.folders[folderName];
            saveFolders();
            refreshFolderSelect();
            refreshFoldersDisplay();
          };
          li.appendChild(a);
          li.appendChild(del);
          ul.appendChild(li);
        });
        section.appendChild(ul);
        container.appendChild(section);
      });
    }
    document.getElementById('folder-form').addEventListener('submit', e => {
      e.preventDefault();
      const folderName = document.getElementById('folder-name').value.trim();
      if (folderName && !window.folders[folderName]) {
        window.folders[folderName] = [];
        saveFolders();
        refreshFolderSelect();
        refreshFoldersDisplay();
        document.getElementById('folder-name').value = '';
      }
    });
    document.getElementById('upload-form').addEventListener('submit', e => {
      e.preventDefault();
      const fileInput = document.getElementById('file-input');
      const linkInput = document.getElementById('link-input');
      const folder = document.getElementById('folder-select').value;
      const file = fileInput.files[0];
      const link = linkInput.value.trim();
      if (!folder) return alert('Please select a folder.');
      if (!file && !link) return alert('No file or link provided.');
      if (file) {
        const reader = new FileReader();
        reader.onload = () => {
          const blob = new Blob([reader.result]);
          const url = URL.createObjectURL(blob);
          const name = file.name;
          window.folders[folder].push({ name, url });
          saveFolders();
          refreshFoldersDisplay();
        };
        reader.readAsArrayBuffer(file);
      } else if (link) {
        let name;
        try {
          const urlObj = new URL(link);
          name = urlObj.pathname.split('/').pop() || urlObj.hostname;
        } catch (err) {
          name = link;
        }
        window.folders[folder].push({ name, url: link });
        saveFolders();
        refreshFoldersDisplay();
      }
      fileInput.value = '';
      linkInput.value = '';
    });
    document.addEventListener('DOMContentLoaded', () => {
      refreshFolderSelect();
      refreshFoldersDisplay();
    });
    // Updated Grade Fetching Script with Fixed Template String
   fetch('https://script.google.com/macros/s/AKfycbxo44kCznno0bGWMVSWJMW-W39dPsEcJRXV4TSpxDuOjEyxxiMGsTw6R1heCbP1sEKl/exec')
  .then(response => response.json())
  .then(data => {
    const num = parseFloat(data.grade);
    if (!isNaN(num)) {
      document.getElementById('grade-value').textContent = `${num}%`;
    } else {
      document.getElementById('grade-value').textContent = 'Invalid Grade';
    }
  })
  .catch(error => {
    console.error('Error fetching grade:', error);
    document.getElementById('grade-value').textContent = 'Error';
  });

      });
  </script>
</body>
</html>
